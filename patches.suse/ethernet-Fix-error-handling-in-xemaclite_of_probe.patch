From: Miaoqian Lin <linmq006@gmail.com>
Date: Tue, 8 Mar 2022 02:47:49 +0000
Subject: ethernet: Fix error handling in xemaclite_of_probe
Git-commit: b19ab4b38b06aae12442b2de95ccf58b5dc53584
Patch-mainline: v5.17-rc8
References: CVE-2022-48860 bsc#1228008

This node pointer is returned by of_parse_phandle() with refcount
incremented in this function. Calling of_node_put() to avoid the
refcount leak. As the remove function do.

Fixes: 5cdaaa12866e ("net: emaclite: adding MDIO and phy lib support")
Signed-off-by: Miaoqian Lin <linmq006@gmail.com>
Reviewed-by: Andrew Lunn <andrew@lunn.ch>
Link: https://lore.kernel.org/r/20220308024751.2320-1-linmq006@gmail.com
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Acked-by: Stanimir Varbanov <svarbanov@suse.de>
---
 drivers/net/ethernet/xilinx/xilinx_emaclite.c |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

--- a/drivers/net/ethernet/xilinx/xilinx_emaclite.c
+++ b/drivers/net/ethernet/xilinx/xilinx_emaclite.c
@@ -1159,7 +1159,7 @@ static int xemaclite_of_probe(struct pla
 	if (rc) {
 		dev_err(dev,
 			"Cannot register network device, aborting\n");
-		goto error;
+		goto put_node;
 	}
 
 	dev_info(dev,
@@ -1167,6 +1167,8 @@ static int xemaclite_of_probe(struct pla
 		 (unsigned long __force)ndev->mem_start, lp->base_addr, ndev->irq);
 	return 0;
 
+put_node:
+	of_node_put(lp->phy_node);
 error:
 	free_netdev(ndev);
 	return rc;
